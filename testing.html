 <!DOCTYPE html>
  <html>
   <head>
    <title>Neopixel control</title>
    <meta name='mobile-web-app-capable' content='yes' />
    <meta name='viewport' content='width=device-width' />
   </head>
   <body>
    <script>
     function toggleDetails() {
      var elem = document.getElementById("my_details");
      if (elem.open == true) {
       elem.open = false;
      }
      else {
       elem.open = true;
      }
     }
    </script>
    <button id="my_toggler" onclick="toggleDetails()">
     <details id="my_details" onclick="toggleDetails()">
      <summary id="my_summary">Palette</summary>
      <iframe srcdoc="
       <body style='margin: 0px; padding: 0px;'>
        <canvas id='colorspace'></canvas>
       </body>
       <script type='text/javascript'>
        (function () {
         var canvas = document.getElementById('colorspace');
         var ctx = canvas.getContext('2d');
         function drawCanvas() {
          var colours = ctx.createLinearGradient(0, 0, window.innerWidth, 0);
          for (var i=0; i <= 360; i+=10) {
           colours.addColorStop(i/360, 'hsl(' + i + ', 100%, 50%)');
          }
          ctx.fillStyle = colours;
          ctx.fillRect(0, 0, window.innerWidth, window.innerHeight);
          var luminance = ctx.createLinearGradient(0, 0, 0, ctx.canvas.height);
          luminance.addColorStop(0,    '#ffffff');
          luminance.addColorStop(0.05, '#ffffff');
          luminance.addColorStop(0.5,  'rgba(0,0,0,0)');
          luminance.addColorStop(0.95, '#000000');
          luminance.addColorStop(1,    '#000000');
          ctx.fillStyle = luminance;
          ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);
         }
         var eventLocked = false;
         function handleEvent(clientX, clientY) {
          if (eventLocked) {
           return;
          }
          function colourCorrect(v) {
           return Math.round(1023-(v*v)/64);
          }
          function rgb_to_hex(i) {
           return (255-(Math.floor((colourCorrect(i))/4))).toString(16).padStart(2, '0');
          }
          var data = ctx.getImageData(clientX, clientY, 1, 1).data;
          var my_r = rgb_to_hex(data[0]);
          var my_g = rgb_to_hex(data[1]);
          var my_b = rgb_to_hex(data[2]);
          var my_r_inv = rgb_to_hex(255-data[0]);
          var my_g_inv = rgb_to_hex(255-data[1]);
          var my_b_inv = rgb_to_hex(255-data[2]);
          function drawCoordinates(x,y) {
           var ctx = document.getElementById('colorspace').getContext('2d');
           var pointSize = 3;
           ctx.fillStyle = '#' + my_r_inv + my_g_inv + my_b_inv;
           ctx.beginPath();
           ctx.arc(x, y, pointSize, 0, Math.PI * 2, true);
           ctx.fill();
          }
          drawCanvas();
          drawCoordinates(clientX, clientY);
          var my_details = parent.document.getElementById('my_details');
          my_details.style.background = '#' + my_r + my_g + my_b;
          my_details.style.color = '#' + my_r_inv + my_g_inv + my_b_inv;
          var params = [
           'r=' + colourCorrect(data[0]),
           'g=' + colourCorrect(data[1]),
           'b=' + colourCorrect(data[2])
           ].join('&');
          var req = new XMLHttpRequest();
          req.open('POST', '?' + params, true);
          req.send();
          eventLocked = true;
          req.onreadystatechange = function() {
           if (req.readyState == 4) {
            eventLocked = false;
           }
          }
         }
         canvas.addEventListener('click', function(event) {
          var rect = canvas.getBoundingClientRect();
          var my_x = event.clientX - rect.left;
          var my_y = event.clientY - rect.top;
          handleEvent(my_x, my_y, true);
          }, false);
         canvas.addEventListener('touchmove', function(event) {
          var rect = canvas.getBoundingClientRect();
          var my_x = event.touches[0].clientX - rect.left;
          var my_y = event.touches[0].clientY - rect.top;
          handleEvent(my_x, my_y);
          }, false);
         function resizeCanvas() {
          canvas.width  = window.innerWidth;
          canvas.height = window.innerHeight;
          drawCanvas();
         }
         window.addEventListener('resize', resizeCanvas, false);
         resizeCanvas();
         drawCanvas();
         document.ontouchmove = function(e) {e.preventDefault()};
        })();
       </script>
      ">
      </iframe>
     </details>
    </button>
   </body>
  </html>
